<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BPL74 Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Playfair+Display:wght@700&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0f0f0f;
      --surface: #181818;
      --border: #2a2a2a;
      --accent: #c8a96e;
      --accent-dim: rgba(200, 169, 110, 0.12);
      --text: #e8e2d9;
      --text-muted: #6b6560;
      --mono: 'DM Mono', monospace;
      --serif: 'Playfair Display', serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--mono);
      min-height: 100vh;
    }

    /* ── LOGIN ── */
    #login-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 2rem;
      background:
        radial-gradient(ellipse 60% 40% at 50% 0%, rgba(200,169,110,0.07) 0%, transparent 70%),
        var(--bg);
    }

    .login-box {
      width: 100%;
      max-width: 400px;
      border: 1px solid var(--border);
      padding: 3rem 2.5rem;
      position: relative;
    }

    .login-box::before {
      content: '';
      position: absolute;
      top: -1px; left: -1px; right: -1px;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
    }

    .login-logo {
      font-family: var(--serif);
      font-size: 1.8rem;
      color: var(--accent);
      margin-bottom: 0.25rem;
    }

    .login-sub {
      font-size: 0.7rem;
      color: var(--text-muted);
      letter-spacing: 0.2em;
      text-transform: uppercase;
      margin-bottom: 2.5rem;
    }

    .field-label {
      font-size: 0.65rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
      display: block;
    }

    .field-group {
      margin-bottom: 1.25rem;
    }

    input[type="password"] {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: var(--mono);
      font-size: 0.9rem;
      padding: 0.75rem 1rem;
      outline: none;
      transition: border-color 0.2s;
    }

    input[type="password"]:focus {
      border-color: var(--accent);
    }

    .btn {
      width: 100%;
      background: var(--accent);
      color: #0f0f0f;
      border: none;
      font-family: var(--mono);
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      padding: 0.85rem;
      cursor: pointer;
      transition: opacity 0.2s;
      margin-top: 0.5rem;
    }

    .btn:hover { opacity: 0.85; }

    .login-error {
      font-size: 0.75rem;
      color: #e07070;
      margin-top: 0.75rem;
      display: none;
    }

    /* ── ADMIN ── */
    #admin-screen { display: none; }

    header {
      border-bottom: 1px solid var(--border);
      padding: 1.25rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      background: rgba(15,15,15,0.95);
      backdrop-filter: blur(8px);
      z-index: 10;
    }

    .header-left {
      display: flex;
      align-items: baseline;
      gap: 1rem;
    }

    .header-title {
      font-family: var(--serif);
      font-size: 1.3rem;
      color: var(--accent);
    }

    .header-table {
      font-size: 0.65rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .record-count {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .record-count span {
      color: var(--accent);
    }

    .btn-sm {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      font-family: var(--mono);
      font-size: 0.65rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 0.4rem 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-sm:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    main {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* ── CARDS ── */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.25rem;
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      padding: 1.5rem;
      position: relative;
      animation: fadeUp 0.4s ease both;
      transition: border-color 0.2s;
    }

    .card:hover {
      border-color: rgba(200,169,110,0.3);
    }

    .card::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 1px;
      background: linear-gradient(90deg, var(--accent), transparent);
      opacity: 0;
      transition: opacity 0.2s;
    }

    .card:hover::after { opacity: 1; }

    .card-id {
      font-size: 0.6rem;
      color: var(--text-muted);
      letter-spacing: 0.1em;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }

    .field-row {
      margin-bottom: 0.85rem;
    }

    .field-key {
      font-size: 0.6rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 0.2rem;
    }

    .field-val {
      font-size: 0.82rem;
      color: var(--text);
      line-height: 1.5;
      word-break: break-word;
    }

    .field-val.long {
      max-height: 80px;
      overflow: hidden;
      position: relative;
    }

    .field-val.long::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 30px;
      background: linear-gradient(transparent, var(--surface));
    }

    /* ── STATES ── */
    .state-msg {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-muted);
      font-size: 0.8rem;
      letter-spacing: 0.1em;
    }

    .loading-dots::after {
      content: '...';
      animation: dots 1.2s steps(4, end) infinite;
    }

    @keyframes dots {
      0%, 100% { content: ''; }
      25% { content: '.'; }
      50% { content: '..'; }
      75% { content: '...'; }
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* stagger cards */
    .card:nth-child(1)  { animation-delay: 0.05s; }
    .card:nth-child(2)  { animation-delay: 0.10s; }
    .card:nth-child(3)  { animation-delay: 0.15s; }
    .card:nth-child(4)  { animation-delay: 0.20s; }
    .card:nth-child(5)  { animation-delay: 0.25s; }
    .card:nth-child(6)  { animation-delay: 0.30s; }
    .card:nth-child(n+7){ animation-delay: 0.35s; }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">BPL74</div>
    <div class="login-sub">Admin Portal</div>
    <div class="field-group">
      <label class="field-label" for="pw-input">Password</label>
      <input type="password" id="pw-input" placeholder="Enter admin password" autocomplete="current-password"/>
    </div>
    <button class="btn" id="login-btn">Access Admin</button>
    <div class="login-error" id="login-error">Incorrect password. Please try again.</div>
  </div>
</div>

<!-- ADMIN -->
<div id="admin-screen">
  <header>
    <div class="header-left">
      <div class="header-title">BPL74</div>
      <div class="header-table">Posts</div>
    </div>
    <div class="header-right">
      <div class="record-count" id="record-count"></div>
      <button class="btn-sm" id="refresh-btn">↻ Refresh</button>
      <button class="btn-sm" id="logout-btn">Sign Out</button>
    </div>
  </header>

  <main>
    <div id="content">
      <div class="state-msg"><span class="loading-dots">Loading</span></div>
    </div>
  </main>
</div>

<script>
  // ── CONFIG ──────────────────────────────────────────────
  const WORKER_URL = 'https://combpl74.jmirando.workers.dev';
  const TABLE_NAME = 'Posts';
  // ────────────────────────────────────────────────────────

  let adminPassword = '';

  // Login
  document.getElementById('login-btn').addEventListener('click', attemptLogin);
  document.getElementById('pw-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') attemptLogin();
  });

  async function attemptLogin() {
    const pw = document.getElementById('pw-input').value.trim();
    if (!pw) return;

    adminPassword = pw;

    // Test the password by making a real request
    const records = await fetchRecords();
    if (records === null) {
      document.getElementById('login-error').style.display = 'block';
      adminPassword = '';
    } else {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('admin-screen').style.display = 'block';
      renderCards(records);
    }
  }

  // Logout
  document.getElementById('logout-btn').addEventListener('click', () => {
    adminPassword = '';
    document.getElementById('pw-input').value = '';
    document.getElementById('login-error').style.display = 'none';
    document.getElementById('admin-screen').style.display = 'none';
    document.getElementById('login-screen').style.display = 'flex';
  });

  // Refresh
  document.getElementById('refresh-btn').addEventListener('click', async () => {
    document.getElementById('content').innerHTML =
      '<div class="state-msg"><span class="loading-dots">Loading</span></div>';
    const records = await fetchRecords();
    if (records) renderCards(records);
  });

  // Fetch from Worker
  async function fetchRecords() {
    try {
      const res = await fetch(`${WORKER_URL}?table=${encodeURIComponent(TABLE_NAME)}`, {
        headers: { 'X-Admin-Password': adminPassword }
      });
      if (res.status === 401) return null;
      const data = await res.json();
      if (data.error) return null;
      return data.records || [];
    } catch (e) {
      return null;
    }
  }

  // Render cards
  function renderCards(records) {
    const countEl = document.getElementById('record-count');
    countEl.innerHTML = `<span>${records.length}</span> records`;

    const content = document.getElementById('content');

    if (records.length === 0) {
      content.innerHTML = '<div class="state-msg">No records found in Posts.</div>';
      return;
    }

    const grid = document.createElement('div');
    grid.className = 'grid';

    records.forEach(record => {
      const card = document.createElement('div');
      card.className = 'card';

      const idRow = document.createElement('div');
      idRow.className = 'card-id';
      idRow.textContent = record.id;
      card.appendChild(idRow);

      const fields = record.fields || {};
      Object.entries(fields).forEach(([key, val]) => {
        const row = document.createElement('div');
        row.className = 'field-row';

        const keyEl = document.createElement('div');
        keyEl.className = 'field-key';
        keyEl.textContent = key;

        const valEl = document.createElement('div');
        valEl.className = 'field-val';

        let display = '';
        if (val === null || val === undefined) {
          display = '—';
        } else if (Array.isArray(val)) {
          display = val.join(', ');
        } else if (typeof val === 'object') {
          display = JSON.stringify(val, null, 2);
        } else {
          display = String(val);
        }

        if (display.length > 120) valEl.classList.add('long');
        valEl.textContent = display;

        row.appendChild(keyEl);
        row.appendChild(valEl);
        card.appendChild(row);
      });

      grid.appendChild(card);
    });

    content.innerHTML = '';
    content.appendChild(grid);
  }
</script>
</body>
</html>